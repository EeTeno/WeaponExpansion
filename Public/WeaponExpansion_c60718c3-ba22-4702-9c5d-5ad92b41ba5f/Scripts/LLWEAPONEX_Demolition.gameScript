INIT
	LIST<SKILL>:%LLWEAPONEX_Demolition_BonusSkills
	LIST<FIXEDSTRING>:%LLWEAPONEX_Demolition_BonusSkillNames
EVENTS

EVENT LLWEAPONEX_Demolition_AddToList
VARS
	SKILL:_Skill
	STRING:_SkillNameStr
	FIXEDSTRING:_SkillName
ON
	OnSkillAdded(S_LLWEAPONEX_VendingMachine_A_680d2702-721c-412d-b083-4f5e816b945a, _Skill, 0)
ACTIONS
	Print(_SkillNameStr, "[1}", _Skill)
	Cast(_SkillName, _SkillNameStr)
	ListAdd(%LLWEAPONEX_Demolition_BonusSkills, _Skill)
	ListAdd(%LLWEAPONEX_Demolition_BonusSkillNames, _SkillName)
	CharacterRemoveSkill(S_LLWEAPONEX_VendingMachine_A_680d2702-721c-412d-b083-4f5e816b945a, _Skill)
	CharacterEvent(S_LLWEAPONEX_VendingMachine_A_680d2702-721c-412d-b083-4f5e816b945a, "LLWEAPONEX_Demolition_SkillAddedToList")

/*
EVENT LLWEAPONEX_Demolition_InitList
ON
	OnFunction("LLWEAPONEX_Demolition_InitList")
ACTIONS
	ListClear(%LLWEAPONEX_Demolition_BonusSkills)
	ListAdd(%LLWEAPONEX_Demolition_BonusSkills, Projectile_LLWEAPONEX_Status_Demolition_ArmorPiercing)
	ListAdd(%LLWEAPONEX_Demolition_BonusSkills, Projectile_LLWEAPONEX_Status_Demolition_NailBomb)
	ListAdd(%LLWEAPONEX_Demolition_BonusSkills, Projectile_LLWEAPONEX_Status_Demolition_Flashbang)
	ListAdd(%LLWEAPONEX_Demolition_BonusSkills, Projectile_LLWEAPONEX_Status_Demolition_Molotov)
	ListAdd(%LLWEAPONEX_Demolition_BonusSkills, Projectile_LLWEAPONEX_Status_Demolition_CursedMolotov)
	ListAdd(%LLWEAPONEX_Demolition_BonusSkills, Projectile_LLWEAPONEX_Status_Demolition_Love)
	ListAdd(%LLWEAPONEX_Demolition_BonusSkills, Projectile_LLWEAPONEX_Status_Demolition_MindMaggot)
	ListAdd(%LLWEAPONEX_Demolition_BonusSkills, Projectile_LLWEAPONEX_Status_Demolition_ChemicalWarfare)
	ListAdd(%LLWEAPONEX_Demolition_BonusSkills, Projectile_LLWEAPONEX_Status_Demolition_Terror)
	ListAdd(%LLWEAPONEX_Demolition_BonusSkills, Projectile_LLWEAPONEX_Status_Demolition_Ice)
	ListAdd(%LLWEAPONEX_Demolition_BonusSkills, Projectile_LLWEAPONEX_Status_Demolition_BlessedIce)
	ListAdd(%LLWEAPONEX_Demolition_BonusSkills, Projectile_LLWEAPONEX_Status_Demolition_Holy)
	ListAdd(%LLWEAPONEX_Demolition_BonusSkills, Projectile_LLWEAPONEX_Status_Demolition_Tremor)
	ListAdd(%LLWEAPONEX_Demolition_BonusSkills, Projectile_LLWEAPONEX_Status_Demolition_Taser)
	ListAdd(%LLWEAPONEX_Demolition_BonusSkills, Projectile_LLWEAPONEX_Status_Demolition_WaterBalloon)
	ListAdd(%LLWEAPONEX_Demolition_BonusSkills, Projectile_LLWEAPONEX_Status_Demolition_WaterBlessedBalloon)
	ListAdd(%LLWEAPONEX_Demolition_BonusSkills, Projectile_LLWEAPONEX_Status_Demolition_SmokeBomb)
	ListAdd(%LLWEAPONEX_Demolition_BonusSkills, Projectile_LLWEAPONEX_Status_Demolition_MustardGas)
	ListAdd(%LLWEAPONEX_Demolition_BonusSkills, Projectile_LLWEAPONEX_Status_Demolition_OilFlask)
	ListAdd(%LLWEAPONEX_Demolition_BonusSkills, Projectile_LLWEAPONEX_Status_Demolition_BlessedOilFlask)
	ListAdd(%LLWEAPONEX_Demolition_BonusSkills, Projectile_LLWEAPONEX_Status_Demolition_PoisonFlask)
	ListAdd(%LLWEAPONEX_Demolition_BonusSkills, Projectile_LLWEAPONEX_Status_Demolition_CursedPoisonFlask)
*/

EVENT LLWEAPONEX_Demolition_InitList_Start
VARS
	INT:_Size
ON
	OnItemEvent(_, "LeaderLib_Initialized")
	OnFunction("LLWEAPONEX_Demolition_CheckInit")
	OnGlobalFlagSet("LLWEAPONEX_DemolitionBackpackEquipped")
ACTIONS
IF "!c1|(c1&c2)"
	ListGetSize(%LLWEAPONEX_Demolition_BonusSkills, _Size)
	IsEqual(_Size, 0)
THEN
	CallFunction("LLWEAPONEX_Demolition_InitList")
ENDIF

EVENT LLWEAPONEX_Demolition_Sabotage
VARS
	CHARACTER:_Player
	FLOAT3:_Pos
ON
	OnCharacterEvent(_Player, "LLWEAPONEX_DemolitionBonus_Sabotage")
ACTIONS
IF "c1&!c2"
	GetVar(_Pos, _Player, "LLWEAPONEX_Demolition_BonusPosition")
	IsEqual(_Pos, null)
THEN
	ExplodeAt(_Pos, Projectile_LLWEAPONEX_Status_Demolition_Sabotage_EnemyOnly, 1, _Player)
ENDIF

EVENT LLWEAPONEX_Demolition_GrenadeBonus_Default
VARS
	CHARACTER:_Player
	FLOAT3:_Pos
	INT:_Level
	FLOAT:_LevelF
ON
	OnCharacterEvent(_Player, "LLWEAPONEX_DemolitionBonus_DefaultGrenadeSkill")
ACTIONS
IF "c1&!c2"
	GetVar(_Pos, _Player, "LLWEAPONEX_Demolition_BonusPosition")
	IsEqual(_Pos, null)
THEN
	IF "c1"
		CharacterGetStat(_LevelF, _Player, Level)
	THEN
		Cast(_Level, _LevelF)
	ELSE
		Set(_Level, 1)
	ENDIF
	ExplodeAt(_Pos, Projectile_LLWEAPONEX_Status_Demolition_Default, _Level, _Player)
ENDIF

EVENT LLWEAPONEX_Demolition_SkillBonus
VARS
	CHARACTER:_Player
	FLOAT3:_Pos
	INT:_SkillIndex
	SKILL:_Skill
	INT:_Level
	FLOAT:_LevelF
	FIXEDSTRING:_SkillName
	FIXEDSTRING:_SkillNameCheck
	INT:_Index
	INT:_Size
	INT:_FoundSkill
ON
	OnCharacterEvent(_Player, "LLWEAPONEX_DemolitionBonus_SkillBonus")
ACTIONS
IF "c1&!c2"
	GetVar(_Pos, _Player, "LLWEAPONEX_Demolition_BonusPosition")
	IsEqual(_Pos, null)
THEN
	IF "c1"
		CharacterGetStat(_LevelF, _Player, Level)
	THEN
		Cast(_Level, _LevelF)
	ELSE
		Set(_Level, 1)
	ENDIF
	
	IF "c1&!c2&c3"
		GetVar(_SkillIndex, _Player, "LLWEAPONEX_Demolition_SkillIndex")
		IsEqual(_SkillIndex, null)
		ListGet(%LLWEAPONEX_Demolition_BonusSkills, _SkillIndex, _Skill)
	THEN
		//Success!
	ENDIF
	
	/*
	IF "c1&!c2&c3"
		GetVar(_SkillName, _Player, "LLWEAPONEX_Demolition_BonusSkillName")
		IsEqual(_SkillName, null)
		ListGetSize(%LLWEAPONEX_Demolition_BonusSkillNames, _Size)
	THEN
		Set(_Index, 1)
		Set(_FoundSkill, 0)
		WHILE "!c1|!c2"
			IsGreaterThen(_Index, _Size)
			IsEqual(_FoundSkill, 1)
		DO
			IF "c1&c2"
				ListGet(%LLWEAPONEX_Demolition_BonusSkillNames, _Index, _SkillNameCheck)
				IsEqual(_SkillName, _SkillNameCheck)
			THEN
				Set(_FoundSkill, 1)
			ELSE
				Add(_Index, 1)
			ENDIF
		ENDWHILE
		IF "c1&c2"
			IsEqual(_FoundSkill, 1)
			ListGet(%LLWEAPONEX_Demolition_BonusSkills, _Index, _Skill)
		THEN
			//Success!
		ENDIF
	ENDIF
	*/
	IF "c1"
		IsEqual(_Skill, null)
	THEN
		Set(_Skill, Projectile_LLWEAPONEX_Status_Demolition_Default)
	ENDIF
	ExplodeAt(_Pos, _Skill, _Level, _Player)
ENDIF