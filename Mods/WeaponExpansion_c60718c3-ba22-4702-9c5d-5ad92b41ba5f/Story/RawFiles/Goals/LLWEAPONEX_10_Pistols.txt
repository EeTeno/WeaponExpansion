Version 1
SubGoalCombiner SGC_AND
INITSECTION

KBSECTION
//EQ_LLWEAPONEX_Hide_Pistol_A_Ring1_728f8b1a-7f4d-4912-85e4-054f817f2592
//EQ_LLWEAPONEX_Hide_Pistol_A_Ring2_b183308c-8348-4079-abfa-2c2eca78d2cd

IF
CharacterUsedSkill(_Char, "Projectile_LLWEAPONEX_Pistol_A_Shoot", _, _)
THEN
LeaderLib_Timers_StartObjectTimer(_Char, 350, "Timers_LLWEAPONEX_Pistols_PlayPistolFX", "LLWEAPONEX_Pistols_PlayPistolFX");

IF
StoryEvent((CHARACTERGUID)_Char, "LLWEAPONEX_Pistols_PlayPistolFX")
THEN
ApplyStatus(_Char, "LLWEAPONEX_FX_PISTOL_A_SHOOT", 6.0, 1, _Char);

/*
IF
StoryEvent((CHARACTERGUID)_Char, "LLWEAPONEX_Pistols_PlayPistolFX")
AND
PlayLoopEffect(_Char, "LLWEAPONEX_FX_Skills_Pistol_A_Shoot_Hand_Pistol_Loop_01", "Dummy_L_HandFX", _Handle)
THEN
DB_LLWEAPONEX_Pistols_Temp_ShootFX(_Char, "Projectile_LLWEAPONEX_Pistol_A_Shoot", _Handle);

IF
StoryEvent((CHARACTERGUID)_Char, "LLWEAPONEX_Pistols_StopAnimation")
AND
DB_LLWEAPONEX_Pistols_Temp_ShootFX(_Char, "Projectile_LLWEAPONEX_Pistol_A_Shoot", _Handle)
THEN
NOT DB_LLWEAPONEX_Pistols_Temp_ShootFX(_Char, "Projectile_LLWEAPONEX_Pistol_A_Shoot", _Handle);
StopLoopEffect(_Handle);
*/

//Dwarves and elves don't have a good shoot -> stow animation like humans/lizards do
QRY
LLWEAPONEX_Pistols_QRY_NeedsToSheathe((CHARACTERGUID)_Char)
AND
LeaderLib_Helper_QRY_IsRace(_Char, "DWARF")
THEN
DB_NOOP(1);

QRY
LLWEAPONEX_Pistols_QRY_NeedsToSheathe((CHARACTERGUID)_Char)
AND
LeaderLib_Helper_QRY_IsRace(_Char, "ELF")
THEN
DB_NOOP(1);

IF
SkillCast(_Char, "Projectile_LLWEAPONEX_Pistol_A_Shoot", _, _)
AND
LLWEAPONEX_Pistols_QRY_NeedsToSheathe(_Char)
THEN
LeaderLib_Timers_StartObjectTimer(_Char, 600, "Timers_LLWEAPONEX_Pistols_StopAnimation", "LLWEAPONEX_Pistols_StopAnimation");

IF
SkillCast(_Char, "Projectile_LLWEAPONEX_Pistol_A_Shoot", _, _)
AND
NOT LLWEAPONEX_Pistols_QRY_NeedsToSheathe(_Char)
THEN
LeaderLib_Timers_StartObjectTimer(_Char, 500, "Timers_LLWEAPONEX_Pistols_RemovePistolFX", "LLWEAPONEX_Pistols_RemovePistolFX");

IF
StoryEvent((CHARACTERGUID)_Char, "LLWEAPONEX_Pistols_RemovePistolFX")
THEN
RemoveStatus(_Char, "LLWEAPONEX_FX_PISTOL_A_SHOOT");

IF
StoryEvent((CHARACTERGUID)_Char, "LLWEAPONEX_Pistols_StopAnimation")
THEN
LeaderLib_Helper_ClearActionQueue(_Char);
PlayAnimation(_Char, "skill_cast_ll_pistol_01_sheathe", "LLWEAPONEX_Pistols_RemovePistolFX");
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "LLWEAPONEX_00_PostCC"