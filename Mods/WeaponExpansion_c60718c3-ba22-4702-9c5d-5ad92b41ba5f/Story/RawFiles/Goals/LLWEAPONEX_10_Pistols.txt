Version 1
SubGoalCombiner SGC_AND
INITSECTION
LLWEAPONEX_Pistols_InitSettings();
KBSECTION
PROC
LLWEAPONEX_Pistols_InitSettings()
THEN
DB_LLWEAPONEX_Pistols_HandProjectiles("DWARF", 0, "Projectile_LLWEAPONEX_Pistol_A_Shoot_LeftHand", 600, "LLWEAPONEX_FX_PISTOL_EXPLOSION_LEFT");
DB_LLWEAPONEX_Pistols_HandProjectiles("DWARF", 1, "Projectile_LLWEAPONEX_Pistol_A_Shoot_RightHand", 600, "LLWEAPONEX_FX_PISTOL_EXPLOSION_RIGHT");
DB_LLWEAPONEX_Pistols_HandProjectiles("ELF", 0, "Projectile_LLWEAPONEX_Pistol_A_Shoot_RightHand", 250, "LLWEAPONEX_FX_PISTOL_EXPLOSION_RIGHT");
DB_LLWEAPONEX_Pistols_HandProjectiles("ELF", 1, "Projectile_LLWEAPONEX_Pistol_A_Shoot_RightHand", 250, "LLWEAPONEX_FX_PISTOL_EXPLOSION_RIGHT");
DB_LLWEAPONEX_Pistols_HandProjectiles("HUMAN", 0, "Projectile_LLWEAPONEX_Pistol_A_Shoot_LeftHand", 400, "LLWEAPONEX_FX_PISTOL_EXPLOSION_LEFT");
DB_LLWEAPONEX_Pistols_HandProjectiles("HUMAN", 1, "Projectile_LLWEAPONEX_Pistol_A_Shoot_LeftHand", 400, "LLWEAPONEX_FX_PISTOL_EXPLOSION_LEFT");
DB_LLWEAPONEX_Pistols_HandProjectiles("LIZARD", 0, "Projectile_LLWEAPONEX_Pistol_A_Shoot_RightHand", 800, "LLWEAPONEX_FX_PISTOL_EXPLOSION_RIGHT");
DB_LLWEAPONEX_Pistols_HandProjectiles("LIZARD", 1, "Projectile_LLWEAPONEX_Pistol_A_Shoot_RightHand", 800, "LLWEAPONEX_FX_PISTOL_EXPLOSION_RIGHT");

DB_LLWEAPONEX_Pistols_ShootingStatus("EQ_LLWEAPONEX_Belt_Pistol_A_94838d55-d5e6-4115-b736-b8b26f321003", "LLWEAPONEX_FX_PISTOL_A_SHOOTING");
DB_LLWEAPONEX_Pistols_ShootingStatus("EQ_UNIQUE_LLWEAPONEX_Belt_Pistol_A_Isshin_A_6e667d23-c8a6-46d6-b6ec-2aa6aa95241d", "LLWEAPONEX_FX_UNIQUE_PISTOL_A_ISSHIN_SHOOTING");
//EQ_LLWEAPONEX_Hide_Pistol_A_Ring1_728f8b1a-7f4d-4912-85e4-054f817f2592
//EQ_LLWEAPONEX_Hide_Pistol_A_Ring2_b183308c-8348-4079-abfa-2c2eca78d2cd

//REGION PISTOL_SHOOT_FX
//Dwarves and elves don't have a good shoot -> stow animation like humans/lizards do
QRY
LLWEAPONEX_Pistols_QRY_NeedsToSheathe((CHARACTERGUID)_Char)
AND
LeaderLib_Helper_QRY_IsRace(_Char, "DWARF")
THEN
DB_NOOP(1);

QRY
LLWEAPONEX_Pistols_QRY_NeedsToSheathe((CHARACTERGUID)_Char)
AND
LeaderLib_Helper_QRY_IsRace(_Char, "ELF")
THEN
DB_NOOP(1);

IF
CharacterUsedSkill(_Char, "Target_LLWEAPONEX_Pistol_A_Shoot", _, _)
AND
LLWEAPONEX_Pistols_QRY_NeedsToSheathe(_Char)
THEN
LeaderLib_Timers_StartObjectTimer(_Char, 350, "Timers_LLWEAPONEX_Pistols_PlayPistolFX", "LLWEAPONEX_Pistols_PlayPistolFX");

IF
CharacterUsedSkill(_Char, "Target_LLWEAPONEX_Pistol_A_Shoot", _, _)
AND
NOT LLWEAPONEX_Pistols_QRY_NeedsToSheathe(_Char)
THEN
LeaderLib_Timers_StartObjectTimer(_Char, 50, "Timers_LLWEAPONEX_Pistols_PlayPistolFX", "LLWEAPONEX_Pistols_PlayPistolFX");

IF
StoryEvent((CHARACTERGUID)_Char, "LLWEAPONEX_Pistols_PlayPistolFX")
AND
CharacterGetEquippedItem(_Char, "Belt", _Pistol)
AND
GetTemplate(_Pistol, _Template)
AND
DB_LLWEAPONEX_Pistols_ShootingStatus(_Template, _Status)
THEN
ApplyStatus(_Char, _Status, 12.0, 1, _Char);

IF
SkillCast(_Char, "Target_LLWEAPONEX_Pistol_A_Shoot", _, _)
AND
//NOT LLWEAPONEX_Pistols_QRY_NeedsToSheathe(_Char)
//AND
IsTagged(_Char, "FEMALE", _IsFemale)
AND
DB_LLWEAPONEX_Pistols_HandProjectiles(_Race, _IsFemale, _ProjectileSkill, _HideHandPistolDelay, _ExplosionStatusFX)
AND
LeaderLib_Helper_QRY_IsRace(_Char, _Race)
THEN
LeaderLib_Timers_StartObjectTimer(_Char, _HideHandPistolDelay, "Timers_LLWEAPONEX_Pistols_RemovePistolFX", "LLWEAPONEX_Pistols_RemovePistolFX");

IF
StoryEvent((CHARACTERGUID)_Char, "LLWEAPONEX_Pistols_RemovePistolFX")
AND
DB_LLWEAPONEX_Pistols_ShootingStatus(_Template, _Status)
THEN
RemoveStatus(_Char, _Status);

IF
StoryEvent((CHARACTERGUID)_Char, "LLWEAPONEX_Pistols_RemovePistolFX")
AND
LLWEAPONEX_Pistols_QRY_NeedsToSheathe(_Char)
THEN
LeaderLib_Helper_ClearActionQueue(_Char);

IF
StoryEvent((CHARACTERGUID)_Char, "LLWEAPONEX_Pistols_StopAnimation")
THEN
LeaderLib_Helper_ClearActionQueue(_Char);
PlayAnimation(_Char, "skill_cast_ll_pistol_01_sheathe", "");

IF
StoryEvent((CHARACTERGUID)_Char, "LLWEAPONEX_Pistols_StopAnimation")
AND
IsTagged(_Char, "FEMALE", _IsFemale)
AND
DB_LLWEAPONEX_Pistols_HandProjectiles(_Race, _IsFemale, _ProjectileSkill, _HideHandPistolDelay, _ExplosionStatusFX)
AND
LeaderLib_Helper_QRY_IsRace(_Char, _Race)
THEN
LeaderLib_Timers_StartObjectTimer(_Char, _HideHandPistolDelay, "Timers_LLWEAPONEX_Pistols_RemovePistolFX", "LLWEAPONEX_Pistols_RemovePistolFX");

IF
SkillCast(_Char, "Target_LLWEAPONEX_Pistol_A_Shoot", _, _)
AND
IsTagged(_Char, "FEMALE", _IsFemale)
AND
DB_LLWEAPONEX_Pistols_HandProjectiles(_Race, _IsFemale, _ProjectileSkill, _HideHandPistolDelay, _ExplosionStatusFX)
AND
LeaderLib_Helper_QRY_IsRace(_Char, _Race)
THEN
ApplyStatus(_Char, _ExplosionStatusFX, 0.2, 1, _Char);
SetVarFixedString(_Char, "LLWEAPONEX_Pistols_ShootProjectileSkill", _ProjectileSkill);
//END_REGION

//REGION PISTOL_SHOOT_PROJECTILE
IF
CharacterUsedSkillAtPosition(_Char, _x, _y, _z, "Target_LLWEAPONEX_Pistol_A_Shoot", _, _)
THEN
SetVarFloat3(_Char, "LLWEAPONEX_Pistols_ShootProjectileTarget", _x, _y, _z);

IF
CharacterUsedSkillOnTarget(_Char, _Target, "Target_LLWEAPONEX_Pistol_A_Shoot", _, _)
AND
GetPosition(_Target, _x, _y, _z)
THEN
SetVarFloat3(_Char, "LLWEAPONEX_Pistols_ShootProjectileTarget", _x, _y, _z);

IF
SkillCast(_Char, "Target_LLWEAPONEX_Pistol_A_Shoot", _, _)
THEN
SetStoryEvent(_Char, "LLWEAPONEX_Pistols_ShootProjectile");
//END_REGION

//REGION PISTOL_DAMAGE
IF
CharacterStatusAttempt(_Target, "LLWEAPONEX_PISTOL_SHOOT_HIT", (CHARACTERGUID)_Cause)
AND
LeaderLib_Helper_QRY_WeaponIsEquipped(_Cause)
THEN
ApplyStatus(_Target, "LLWEAPONEX_PISTOL_SHOOT_HIT_DAMAGE_WEAPON", 0.0, 1, _Cause);

IF
CharacterStatusAttempt(_Target, "LLWEAPONEX_PISTOL_SHOOT_HIT", (CHARACTERGUID)_Cause)
AND
NOT LeaderLib_Helper_QRY_WeaponIsEquipped(_Cause)
THEN
ApplyStatus(_Target, "LLWEAPONEX_PISTOL_SHOOT_HIT_DAMAGE_SCALED", 0.0, 1, _Cause);
//END_REGION
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "LLWEAPONEX_00_PostCC"