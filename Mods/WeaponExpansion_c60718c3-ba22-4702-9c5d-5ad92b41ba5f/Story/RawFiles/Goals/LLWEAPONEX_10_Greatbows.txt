Version 1
SubGoalCombiner SGC_AND
INITSECTION
LLWEAPONEX_Greatbows_InitSettings();

KBSECTION
//REGION SETTINGS
PROC
LLWEAPONEX_Greatbows_InitSettings()
THEN
/*
DB_LLWEAPONEX_Greatbows_PrepareFX("UNDEAD_DWARF", 0,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Dwarves_01", "Dummy_R_Hand", 900);
DB_LLWEAPONEX_Greatbows_PrepareFX("UNDEAD_DWARF", 1,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Dwarves_01", "Dummy_R_Hand", 900);
DB_LLWEAPONEX_Greatbows_PrepareFX("UNDEAD_ELF", 0,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Elves_01", "Dummy_R_Hand", 900);
DB_LLWEAPONEX_Greatbows_PrepareFX("UNDEAD_ELF", 1,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Elves_01", "Dummy_R_Hand", 900);
DB_LLWEAPONEX_Greatbows_PrepareFX("UNDEAD_HUMAN", 0,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Humans_01", "Dummy_R_Hand", 900);
DB_LLWEAPONEX_Greatbows_PrepareFX("UNDEAD_HUMAN", 1,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Humans_01", "Dummy_R_Hand", 900);
DB_LLWEAPONEX_Greatbows_PrepareFX("UNDEAD_LIZARD", 0,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Lizards_01", "Dummy_R_Hand", 900);
DB_LLWEAPONEX_Greatbows_PrepareFX("UNDEAD_LIZARD", 1,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Lizards_01", "Dummy_R_Hand", 900);

DB_LLWEAPONEX_Greatbows_PrepareFX("DWARF", "Undead_Dwarf", 1,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Dwarf_Female", "LowerArm_R_Twist_Bone", 500);
DB_LLWEAPONEX_Greatbows_PrepareFX("DWARF", "Undead_Dwarf", 0,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Dwarf_Male", "LowerArm_R_Twist_Bone", 500);
DB_LLWEAPONEX_Greatbows_PrepareFX("ELF", "Undead_Elf", 1,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Elf_Female", "Dummy_R_Hand", 600);
DB_LLWEAPONEX_Greatbows_PrepareFX("ELF", "Undead_Elf", 0,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Elf_Male", "Dummy_R_Hand", 600);
DB_LLWEAPONEX_Greatbows_PrepareFX("HUMAN", "Undead_Human", 1,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Human_Female", "Dummy_R_Hand", 800);
DB_LLWEAPONEX_Greatbows_PrepareFX("HUMAN", "Undead_Human", 0,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Human_Male", "Dummy_R_Hand", 800);
DB_LLWEAPONEX_Greatbows_PrepareFX("LIZARD", "Undead_Lizard", 1,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Lizard_Female", "LowerArm_R_Twist_Bone", 600);
DB_LLWEAPONEX_Greatbows_PrepareFX("LIZARD", "Undead_Lizard", 0,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Lizard_Male", "LowerArm_R_Twist_Bone", 600);
*/

SysClear("DB_LLWEAPONEX_Greatbows_PrepareFX", 5);
DB_LLWEAPONEX_Greatbows_PrepareFX("DWARF", 1,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Dwarf_Female", "LowerArm_R_Twist_Bone", 500);
DB_LLWEAPONEX_Greatbows_PrepareFX("DWARF", 0,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Dwarf_Male", "LowerArm_R_Twist_Bone", 500);
//DB_LLWEAPONEX_Greatbows_PrepareFX("DWARF", 1,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Human_Female", "Dummy_R_Hand", 500);
//DB_LLWEAPONEX_Greatbows_PrepareFX("DWARF", 0,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Human_Male", "Dummy_R_Hand", 400);
DB_LLWEAPONEX_Greatbows_PrepareFX("ELF", 1,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Elf_Female", "Dummy_R_Hand", 600);
DB_LLWEAPONEX_Greatbows_PrepareFX("ELF", 0,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Elf_Male", "Dummy_R_Hand", 600);
DB_LLWEAPONEX_Greatbows_PrepareFX("HUMAN", 1,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Human_Female", "Dummy_R_Hand", 825);
DB_LLWEAPONEX_Greatbows_PrepareFX("HUMAN", 0,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Human_Male", "Dummy_R_Hand", 825);
DB_LLWEAPONEX_Greatbows_PrepareFX("LIZARD", 1,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Lizard_Female", "LowerArm_R_Twist_Bone", 580);
DB_LLWEAPONEX_Greatbows_PrepareFX("LIZARD", 0,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Lizard_Male", "LowerArm_R_Twist_Bone", 600);

SysClear("DB_LLWEAPONEX_Quivers_LoopFX", 4);
DB_LLWEAPONEX_Quivers_LoopFX("DWARF", 1,  "LLWEAPONEX_FX_Quiver_A_Dwarf", "Thigh_R_Twist_Bone");
DB_LLWEAPONEX_Quivers_LoopFX("DWARF", 0,  "LLWEAPONEX_FX_Quiver_A_Dwarf", "Thigh_R_Twist_Bone");
DB_LLWEAPONEX_Quivers_LoopFX("ELF", 1,  "LLWEAPONEX_FX_Quiver_A", "Thigh_R_Twist_Bone");
DB_LLWEAPONEX_Quivers_LoopFX("ELF", 0,  "LLWEAPONEX_FX_Quiver_A", "Thigh_R_Twist_Bone");
DB_LLWEAPONEX_Quivers_LoopFX("HUMAN", 1,  "LLWEAPONEX_FX_Quiver_A", "Thigh_R_Bone");
DB_LLWEAPONEX_Quivers_LoopFX("HUMAN", 0,  "LLWEAPONEX_FX_Quiver_A", "Thigh_R_Twist_Bone");
DB_LLWEAPONEX_Quivers_LoopFX("LIZARD", 1,  "LLWEAPONEX_FX_Quiver_A", "HorseLink_R_Bone");
DB_LLWEAPONEX_Quivers_LoopFX("LIZARD", 0,  "LLWEAPONEX_FX_Quiver_A", "HorseLink_R_Bone");

DB_LLWEAPONEX_Quivers_ArrowTreasure(0, "ST_LLWEAPONEX_Quiver_Arrows");
DB_LLWEAPONEX_Quivers_ArrowTreasure(1, "ST_LLWEAPONEX_Quiver_GreatbowArrows");

DB_LLWEAPONEX_Quivers_RechargeStatus("Shout_LLWEAPONEX_Quiver_DrawArrow", "LLWEAPONEX_QUIVER_DRAW_RECHARGE", 60.0);
//END_REGION

//REGION GREATBOW_START_ATTACK
IF
CharacterStartAttackObject(_, _, _Character)
AND
CharacterGetEquippedWeapon(_Character, _Greatbow)
AND
IsTagged(_Greatbow, "LLWEAPONEX_Greatbow", 1)
THEN
LLWEAPONEX_Greatbows_PlayPreparationEffect(_Character);

IF
CharacterStartAttackPosition(_, _, _, _, _Character)
AND
CharacterGetEquippedWeapon(_Character, _Greatbow)
AND
IsTagged(_Greatbow, "LLWEAPONEX_Greatbow", 1)
THEN
LLWEAPONEX_Greatbows_PlayPreparationEffect(_Character);

IF
CharacterUsedSkill(_Character, "Projectile_LLMIME_MimicGreatBowAttack", _, _)
THEN
LLWEAPONEX_Greatbows_PlayPreparationEffect(_Character);

PROC
LLWEAPONEX_Greatbows_PlayPreparationEffect((CHARACTERGUID)_Character)
AND
NOT DB_LoopEffect(_Character, _, "LLWEAPONEX.FX.GreatbowAttackFX", _, _, _)
AND
IsTagged(_Character, "FEMALE", _IsFemale)
AND
CharacterGetRace(_Character, 1, _Race)
AND
DB_LeaderLib_RaceTags(_Race, _RaceTag)
AND
DB_LLWEAPONEX_Greatbows_PrepareFX(_RaceTag, _IsFemale, _EffectName, _BoneName, _Duration)
THEN
//Play the loop FX with behavior scripting so we can destroy the effect immediately
//LeaderLog_Log("TRACE", "[LLWEAPONEX:Greatbows:PlayPreparationEffect] Playing arrow FX on attacking character. [",_EffectName,":",_BoneName,"]");
PROC_StopLoopEffect(_Character, "LLWEAPONEX.FX.GreatbowAttackFX");
PROC_LoopEffect(_EffectName, _Character, "LLWEAPONEX.FX.GreatbowAttackFX", "__ANY__", _BoneName);
ProcObjectTimer(_Character, "LLWEAPONEX_Timers_StopGreatbowPrepareFX", _Duration);

//NPCs
PROC
LLWEAPONEX_Greatbows_PlayPreparationEffect((CHARACTERGUID)_Character)
AND
NOT DB_LoopEffect(_Character, _, "LLWEAPONEX.FX.GreatbowAttackFX", _, _, _)
AND
IsTagged(_Character, "FEMALE", _IsFemale)
AND
NOT CharacterGetRace(_Character, 1, _)
AND
DB_LeaderLib_RaceTags(_Race, _RaceTag)
AND
IsTagged(_Character, _RaceTag, 1)
AND
DB_LLWEAPONEX_Greatbows_PrepareFX(_RaceTag, _IsFemale, _EffectName, _BoneName, _Duration)
AND
NOT DB_LoopEffect(_Character, _, "LLWEAPONEX.FX.GreatbowAttackFX", _, _, _)
THEN
//Play the loop FX with behavior scripting so we can destroy the effect immediately
//LeaderLog_Log("TRACE", "[LLWEAPONEX:Greatbows:PlayPreparationEffect] Playing arrow FX on attacking character. [",_EffectName,":",_BoneName,"]");
PROC_StopLoopEffect(_Character, "LLWEAPONEX.FX.GreatbowAttackFX");
PROC_LoopEffect(_EffectName, _Character, "LLWEAPONEX.FX.GreatbowAttackFX", "__ANY__", _BoneName);
ProcObjectTimer(_Character, "LLWEAPONEX_Timers_StopGreatbowPrepareFX", _Duration);

PROC
ProcObjectTimerFinished((CHARACTERGUID)_Character, "LLWEAPONEX_Timers_StopGreatbowPrepareFX")
THEN
//LeaderLog_Log("TRACE", "[LLWEAPONEX:Greatbows:StopGreatbowPrepareFX] Destroying looped arrow effect.");
PROC_StopLoopEffect(_Character, "LLWEAPONEX.FX.GreatbowAttackFX");
//END_REGION

//REGION QUIVER_FX
IF
ItemEquipped(_Quiver, _Player)
AND
//IsTagged(_Quiver, "LLWEAPONEX_Quiver", 1)
IsTagged(_Quiver, "LLWEAPONEX_Quiver_FX_Enabled", 1)
THEN
LLWEAPONEX_Greatbows_PlayQuiverEffect(_Player);

PROC
LLWEAPONEX_Greatbows_PlayQuiverEffect((CHARACTERGUID)_Player)
THEN
PROC_StopLoopEffect(_Player, "LLWEAPONEX.FX.Quiver");

PROC
LLWEAPONEX_Greatbows_PlayQuiverEffect((CHARACTERGUID)_Player)
AND
NOT DB_LoopEffect(_Player, _, "LLWEAPONEX.FX.Quiver", _, _, _)
AND
IsTagged(_Player, "FEMALE", _IsFemale)
AND
CharacterGetRace(_Player, 1, _Race)
AND
DB_LeaderLib_RaceTags(_Race, _RaceTag)
AND
DB_LLWEAPONEX_Quivers_LoopFX(_RaceTag, _IsFemale, _EffectName, _BoneName)
THEN
PROC_LoopEffect(_EffectName, _Player, "LLWEAPONEX.FX.Quiver", "__ANY__", _BoneName);

//NPCs
PROC
LLWEAPONEX_Greatbows_PlayQuiverEffect((CHARACTERGUID)_Character)
AND
NOT DB_LoopEffect(_Character, _, "LLWEAPONEX.FX.Quiver", _, _, _)
AND
NOT CharacterGetRace(_Character, 1, _)
AND
IsTagged(_Character, "FEMALE", _IsFemale)
AND
DB_LeaderLib_RaceTags(_Race, _RaceTag)
AND
IsTagged(_Character, _Race, 1)
AND
DB_LLWEAPONEX_Quivers_LoopFX(_RaceTag, _IsFemale, _EffectName, _BoneName)
AND
NOT DB_LoopEffect(_Character, _, "LLWEAPONEX.FX.Quiver", _, _, _)
THEN
PROC_LoopEffect(_EffectName, _Character, "LLWEAPONEX.FX.Quiver", "__ANY__", _BoneName);

//New Races
PROC
LLWEAPONEX_Greatbows_PlayQuiverEffect((CHARACTERGUID)_Character)
AND
NOT DB_LoopEffect(_Character, _, "LLWEAPONEX.FX.Quiver", _, _, _)
AND
DB_LLWEAPONEX_Quivers_LoopFX("HUMAN", 1, _EffectName, _BoneName)
THEN
PROC_LoopEffect(_EffectName, _Character, "LLWEAPONEX.FX.Quiver", "__ANY__", _BoneName);

IF
ItemUnEquipped(_Quiver, _Player)
AND
IsTagged(_Quiver, "LLWEAPONEX_Quiver", 1)
THEN
PROC_StopLoopEffect(_Player, "LLWEAPONEX.FX.Quiver");

IF
CharacterPolymorphedInto(_Character, _Race)
AND
DB_LoopEffect(_Character, _, "LLWEAPONEX.FX.Quiver", _, _, _)
AND
NOT DB_LLWEAPONEX_Greatbows_QuiverUpdated(_Character)
AND
IsTagged(_Character, "FEMALE", _IsFemale)
AND
DB_LeaderLib_RaceTags(_Race, _RaceTag)
AND
DB_LLWEAPONEX_Quivers_LoopFX(_RaceTag, _IsFemale, _EffectName, _BoneName)
THEN
PROC_StopLoopEffect(_Character, "LLWEAPONEX.FX.Quiver");
PROC_LoopEffect(_EffectName, _Character, "LLWEAPONEX.FX.Quiver", "__ANY__", _BoneName);
DB_LLWEAPONEX_Greatbows_QuiverUpdated(_Character);

//Non-standard racial polymorphs
IF
CharacterPolymorphedInto(_Character, _Race)
AND
DB_LoopEffect(_Character, _, "LLWEAPONEX.FX.Quiver", _, _, _)
AND
NOT DB_LLWEAPONEX_Greatbows_QuiverUpdated(_Character)
THEN
PROC_StopLoopEffect(_Character, "LLWEAPONEX.FX.Quiver");

IF
CharacterPolymorphedInto(_Character, _Race)
AND
DB_LLWEAPONEX_Greatbows_QuiverUpdated(_Character)
THEN
NOT DB_LLWEAPONEX_Greatbows_QuiverUpdated(_Character);
//END_REGION

//REGION QUIVER_DRAW_ARROW
IF
CharacterStatusApplied(_Character, "LLWEAPONEX_DRAW_ARROW", _)
AND
CharacterGetEquippedItem(_Character, "Weapon", _Weapon)
AND
IsTagged(_Weapon, "LLWEAPONEX_Greatbow", _IsGreatbow)
AND
DB_LLWEAPONEX_Quivers_ArrowTreasure(_IsGreatbow, _TreasureTable)
AND
GetPosition(_Character, _x, _y, _z)
AND
CharacterGetLevel(_Character, _Level)
AND
CreateItemTemplateAtPosition("LOOT_LeaderLib_BackPack_Invisible_98fa7688-0810-4113-ba94-9a8c8463f830", _x, _y, _z, _Backpack)
THEN
LeaderLog_Log("DEBUG", "[LLWEAPONEX:Greatbows:Quivers:LLWEAPONEX_DRAW_ARROW] Generating a random arrow for character via treasure table [",_TreasureTable,"].");
ObjectSetFlag(_Character, "LLWEAPONEX_Quiver_DrewArrow");
GenerateTreasure(_Backpack, _TreasureTable, _Level, _Character);
MoveAllItemsTo(_Backpack, _Character, 1, 1, 1);
ProcObjectTimer(_Backpack, "LLWEAPONEX_Timers_RemoveArrowTreasureBackpack", 250);

PROC
ProcObjectTimerFinished((ITEMGUID)_Backpack, "LLWEAPONEX_Timers_RemoveArrowTreasureBackpack")
THEN
LeaderLog_Log("DEBUG", "[LLWEAPONEX:Greatbows:Quivers:LLWEAPONEX_Timers_RemoveArrowTreasureBackpack] Removing backpack.");
ItemRemove(_Backpack);

IF
ObjectLeftCombat((CHARACTERGUID)_Character, _)
AND
ObjectGetFlag(_Character, "LLWEAPONEX_Quiver_DrewArrow", 1)
THEN
InventoryLaunchTagIterator(_Character, "LLWEAPONEX_Quiver_TemporaryArrow", "", "LLWEAPONEX_FoundQuiverArrow", "");
ObjectClearFlag(_Character, "LLWEAPONEX_Quiver_DrewArrow");

IF
StoryEvent((ITEMGUID)_Arrow, "LLWEAPONEX_FoundQuiverArrow")
THEN
ItemDestroy(_Arrow);
//END_REGION

//REGION QUIVER_RECHARGING
IF
CharacterUsedSkill(_Player, "Shout_LLWEAPONEX_Quiver_DrawArrow", _, _)
AND
CharacterIsPlayer(_Player, 1)
AND
NOT DB_LLWEAPONEX_Quivers_Temp_RechargeAfterCombat(_Player, _, "Shout_LLWEAPONEX_Quiver_DrawArrow")
AND
CharacterGetEquippedItem(_Player, "Belt", (ITEMGUID)_Quiver)
AND
IsTagged(_Quiver, "LLWEAPONEX_Quiver", 1)
AND
ObjectGetFlag(_Quiver, "LLWEAPONEX_ItemNeedsRecharging", 0)
AND
NOT ItemGetMaxCharges(_Quiver, 0)
THEN
DB_LLWEAPONEX_Quivers_Temp_RechargeAfterCombat(_Player, _Quiver, "Shout_LLWEAPONEX_Quiver_DrawArrow");
ObjectSetFlag(_Quiver, "LLWEAPONEX_ItemNeedsRecharging");

IF
ObjectLeftCombat((CHARACTERGUID)_Player, _)
AND
DB_LLWEAPONEX_Quivers_Temp_RechargeAfterCombat(_Player, _Quiver, _Skill)
AND
DB_LLWEAPONEX_Quivers_RechargeStatus(_Skill, _Status, _RechargeSpeed)
THEN
ApplyStatus(_Player, _Status, _RechargeSpeed, 0, _Player);
NOT DB_LLWEAPONEX_Quivers_Temp_RechargeAfterCombat(_Player, _Quiver, _Skill);
DB_LLWEAPONEX_Quivers_Temp_RechargeAfterCombat(_Player, _Quiver, _Skill, _Status, _RechargeSpeed);

IF
DB_LLWEAPONEX_Quivers_Temp_RechargeAfterCombat(_Player, _Quiver, _Skill)
AND
CharacterIsInCombat(_Player, 0)
AND
DB_LLWEAPONEX_Quivers_RechargeStatus(_Skill, _Status, _RechargeSpeed)
THEN
ApplyStatus(_Player, _Status, _RechargeSpeed, 0, _Player);
NOT DB_LLWEAPONEX_Quivers_Temp_RechargeAfterCombat(_Player, _Quiver, _Skill);
DB_LLWEAPONEX_Quivers_Temp_RechargeAfterCombat(_Player, _Quiver, _Skill, _Status, _RechargeSpeed);

IF
CharacterStatusRemoved(_Player, _Status, _)
AND
DB_LLWEAPONEX_Quivers_Temp_RechargeAfterCombat(_Player, _Quiver, _Skill, _Status, _RechargeSpeed)
AND
ObjectExists(_Quiver, 1)
THEN
ItemAddCharges(_Quiver, 1);
LLWEAPONEX_Quivers_ResetRechargeStatus(_Player, _Quiver, _Status, _RechargeSpeed);

PROC
LLWEAPONEX_Quivers_ResetRechargeStatus((CHARACTERGUID)_Player, (ITEMGUID)_Quiver, (STRING)_Status, (REAL)_RechargeSpeed)
AND
NOT LLWEAPONEX_QRY_ChargesAreMaxed(_Quiver)
AND
ItemIsInCharacterInventory(_Quiver, _Player, 1)
THEN
ApplyStatus(_Player, _Status, _RechargeSpeed, 0, _Player);

PROC
LLWEAPONEX_Quivers_ResetRechargeStatus((CHARACTERGUID)_Player, (ITEMGUID)_Quiver, (STRING)_Status, (REAL)_RechargeSpeed)
AND
LLWEAPONEX_QRY_ChargesAreMaxed(_Quiver)
AND
DB_LLWEAPONEX_Quivers_Temp_RechargeAfterCombat(_Player, _Quiver, _Skill, _Status, _RechargeSpeed)
THEN
RemoveStatus(_Player, _Status);
NOT DB_LLWEAPONEX_Quivers_Temp_RechargeAfterCombat(_Player, _Quiver, _Skill, _Status, _RechargeSpeed);
ObjectClearFlag(_Quiver, "LLWEAPONEX_ItemNeedsRecharging");

IF
ItemEquipped(_Quiver, _Player)
AND
ObjectGetFlag(_Quiver, "LLWEAPONEX_ItemNeedsRecharging", 1)
AND
CharacterIsInCombat(_Player, 0)
AND
DB_LLWEAPONEX_Quivers_Temp_RechargeAfterCombat(_OtherPlayer, _Quiver, _Skill, _Status, _RechargeSpeed)
THEN
NOT DB_LLWEAPONEX_Quivers_Temp_RechargeAfterCombat(_OtherPlayer, _Quiver, _Skill, _Status, _RechargeSpeed);
DB_LLWEAPONEX_Quivers_Temp_RechargeAfterCombat(_Player, _Quiver, _Skill, _Status, _RechargeSpeed);
LLWEAPONEX_Quivers_ResetRechargeStatus(_Player, _Quiver, _Status, _RechargeSpeed);

IF
ItemEquipped(_Quiver, _Player)
AND
ObjectGetFlag(_Quiver, "LLWEAPONEX_ItemNeedsRecharging", 1)
AND
CharacterIsInCombat(_Player, 1)
AND
DB_LLWEAPONEX_Quivers_Temp_RechargeAfterCombat(_OtherPlayer, _Quiver, _Skill, _Status, _RechargeSpeed)
THEN
NOT DB_LLWEAPONEX_Quivers_Temp_RechargeAfterCombat(_OtherPlayer, _Quiver, _Skill, _Status, _RechargeSpeed);
DB_LLWEAPONEX_Quivers_Temp_RechargeAfterCombat(_Player, _Quiver, _Skill);

QRY
LLWEAPONEX_QRY_ChargesAreMaxed((ITEMGUID)_Item)
AND
ItemGetCharges(_Item, _Current)
AND
ItemGetMaxCharges(_Item, _Max)
AND
_Current >= _Max
THEN
DB_NOOP(1);

IF
ObjectEnteredCombat((CHARACTERGUID)_Player, _)
AND
DB_LLWEAPONEX_Quivers_Temp_RechargeAfterCombat(_Player, _Quiver, _Skill, _Status, _RechargeSpeed)
THEN
NOT DB_LLWEAPONEX_Quivers_Temp_RechargeAfterCombat(_Player, _Quiver, _Skill, _Status, _RechargeSpeed);
RemoveStatus(_Player, _Status);
DB_LLWEAPONEX_Quivers_Temp_RechargeAfterCombat(_Player, _Quiver, _Skill);
//END_REGION

EXITSECTION

ENDEXITSECTION
ParentTargetEdge "LLWEAPONEX_00_PostCC"