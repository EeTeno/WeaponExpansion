Version 1
SubGoalCombiner SGC_AND
INITSECTION

KBSECTION

IF
CharacterStatusApplied(_Character, "UNSHEATHED", _)
AND
ObjectGetFlag(_Character, "LLWEAPONEX_GrimoireOpened", 1)
THEN
LeaderLib_CancelObjectTimerByEvent(_Character, "LLWEAPONEX_Events_GrimoireFired");
ObjectClearFlag(_Character, "LLWEAPONEX_GrimoireOpened", 0);

IF
CharacterStatusApplied(_Character, "UNSHEATHED", _)
AND
NOT DB_Illusionist(_Character, _)
AND
DB_LLWEAPONEX_Grimoire_ActiveGrimoire(_Character, _Item, _Template)
AND
NOT LLWEAPONEX_Grimoire_QRY_StateChangeLocked(_Character)
THEN
LLWEAPONEX_Grimoire_OnGrimoireUnsheathed(_Character, _Item, _Template);

IF
CharacterStatusRemoved(_Character, "UNSHEATHED", _)
AND
NOT DB_Illusionist(_Character, _)
AND
DB_LLWEAPONEX_Grimoire_ActiveGrimoire(_Character, _Item, _Template)
AND
NOT LLWEAPONEX_Grimoire_QRY_StateChangeLocked(_Character)
THEN
LLWEAPONEX_Grimoire_OnGrimoireSheathed(_Character, _Item, _Template);

//Respec started, delete effects
IF
DB_Illusionist(_Player,_Mirror)
AND
DB_LLWEAPONEX_Grimoire_ActiveGrimoire(_Character, _Item, _Template)
THEN
LLWEAPONEX_Grimoire_StopAllEffects_All(_Character);


//Respec finished, play effects again
PROC
Proc_HomesteadTeleportAfterMirror((CHARACTERGUID)_Player,(ITEMGUID)_Mirror,(TRIGGERGUID)_Trigger)
AND
DB_LLWEAPONEX_Grimoire_ActiveGrimoire(_Character, _Item, _Template)
THEN
LLWEAPONEX_Grimoire_OnGrimoireSheathed(_Character, _Item, _Template);
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "LLWEAPONEX_80_ToggledScripts"