Version 1
SubGoalCombiner SGC_AND
INITSECTION
LLWEAPONEX_Skills_InitSettings();
KBSECTION
IF
DB_LeaderLib_Settings_Initialized(1)
THEN
LLWEAPONEX_Skills_InitSettings();

PROC
LLWEAPONEX_Skills_InitSettings()
THEN
/*
DB_LLWEAPONEX_Greatbows_PrepareFX("UNDEAD_DWARF", 0,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Dwarves_01", "Dummy_R_Hand", 900);
DB_LLWEAPONEX_Greatbows_PrepareFX("UNDEAD_DWARF", 1,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Dwarves_01", "Dummy_R_Hand", 900);
DB_LLWEAPONEX_Greatbows_PrepareFX("UNDEAD_ELF", 0,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Elves_01", "Dummy_R_Hand", 900);
DB_LLWEAPONEX_Greatbows_PrepareFX("UNDEAD_ELF", 1,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Elves_01", "Dummy_R_Hand", 900);
DB_LLWEAPONEX_Greatbows_PrepareFX("UNDEAD_HUMAN", 0,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Humans_01", "Dummy_R_Hand", 900);
DB_LLWEAPONEX_Greatbows_PrepareFX("UNDEAD_HUMAN", 1,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Humans_01", "Dummy_R_Hand", 900);
DB_LLWEAPONEX_Greatbows_PrepareFX("UNDEAD_LIZARD", 0,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Lizards_01", "Dummy_R_Hand", 900);
DB_LLWEAPONEX_Greatbows_PrepareFX("UNDEAD_LIZARD", 1,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Lizards_01", "Dummy_R_Hand", 900);
*/
DB_LLWEAPONEX_Greatbows_PrepareFX("DWARF", 0,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Dwarf_01", "LowerArm_R_Twist_Bone", 500);
DB_LLWEAPONEX_Greatbows_PrepareFX("DWARF", 1,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Dwarf_01", "LowerArm_R_Twist_Bone", 500);
DB_LLWEAPONEX_Greatbows_PrepareFX("ELF", 0,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Elf_01", "Dummy_R_Hand", 600);
DB_LLWEAPONEX_Greatbows_PrepareFX("ELF", 1,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Elf_01", "Dummy_R_Hand", 600);
DB_LLWEAPONEX_Greatbows_PrepareFX("HUMAN", 0,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Human_01", "Dummy_R_Hand", 900);
DB_LLWEAPONEX_Greatbows_PrepareFX("HUMAN", 1,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Human_01", "Dummy_R_Hand", 900);
DB_LLWEAPONEX_Greatbows_PrepareFX("LIZARD", 0,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Lizard_01", "LowerArm_R_Twist_Bone", 500);
DB_LLWEAPONEX_Greatbows_PrepareFX("LIZARD", 1,  "LLWEAPONEX_FX_Projectiles_Greatbow_Arrow_Prepare_Lizard_01", "LowerArm_R_Twist_Bone", 500);

PROC
LLWEAPONEX_Skills_InitSettings()
AND
DB_LeaderLib_Settings_Initialized(1)
AND
NOT LeaderLib_Array_QRY_DataExists("LLWEAPONEX_ChaosSurfaces")
THEN
LeaderLib_Helper_BuildSurfaceList("LLWEAPONEX_ChaosSurfaces", "Standard", "Ground", "", 1);
LeaderLog_Log("DEBUG", "[LLWEAPONEX:WeaponSkills:Settings] Initialized [LLWEAPONEX_ChaosSurfaces] surface list/array.");

IF
DB_LeaderLib_Array_Data("LLWEAPONEX_ChaosSurfaces", _Index, _Surface)
AND
IntegertoString(_Index, _IndexStr)
THEN
LeaderLog_Log("DEBUG", "[LLWEAPONEX:WeaponSkills:Settings] Added surface [",_Surface,"] to array [LLWEAPONEX_ChaosSurfaces] at index [",_IndexStr,"]");

//REGION GREATBOW_START_ATTACK
IF
CharacterStartAttackObject(_, _, _Character)
AND
CharacterGetEquippedWeapon(_Character, _Greatbow)
AND
IsTagged(_Greatbow, "LLWEAPONEX_Greatbow", 1)
THEN
LLWEAPONEX_Greatbows_PlayPreparationEffect(_Character);

IF
CharacterStartAttackPosition(_, _, _, _, _Character)
AND
CharacterGetEquippedWeapon(_Character, _Greatbow)
AND
IsTagged(_Greatbow, "LLWEAPONEX_Greatbow", 1)
THEN
LLWEAPONEX_Greatbows_PlayPreparationEffect(_Character);

PROC
LLWEAPONEX_Greatbows_PlayPreparationEffect((CHARACTERGUID)_Character)
AND
NOT DB_LLWEAPONEX_Greatbows_Temp_ActivePrepareFX(_Character, _)
AND
IsTagged(_Character, "FEMALE", _Female)
AND
DB_LLWEAPONEX_Greatbows_PrepareFX(_RaceTag, _Female, _EffectName, _BoneName, _Duration)
AND
NOT DB_LLWEAPONEX_Greatbows_Temp_ActivePrepareFX(_Character, _)
AND
IsTagged(_Character, _RaceTag, 1)
AND
PlayLoopEffect(_Character, _EffectName, _BoneName, _FxHandle)
THEN
DB_LLWEAPONEX_Greatbows_Temp_ActivePrepareFX(_Character, _FxHandle);
ProcObjectTimer(_Character, "LLWEAPONEX_Timers_StopGreatbowPrepareFX", _Duration);

PROC
ProcObjectTimerFinished((CHARACTERGUID)_Character, "LLWEAPONEX_Timers_StopGreatbowPrepareFX")
AND
DB_LLWEAPONEX_Greatbows_Temp_ActivePrepareFX(_Character, _FxHandle)
THEN
StopLoopEffect(_FxHandle);
NOT DB_LLWEAPONEX_Greatbows_Temp_ActivePrepareFX(_Character, _FxHandle);

IF
TextEventSet("llweap_greatbowfxanim")
AND
CharacterGetHostCharacter(_Character)
THEN
DB_LLWEAPONEX_Debug_LoopingAnim(_Character);
PlayAnimation(_Character, "attack1", "LLWEAPONEX_Debug_KeepPlayingAtttackAnim");

IF
StoryEvent((CHARACTERGUID)_Character, "LLWEAPONEX_Debug_KeepPlayingAtttackAnim")
AND
DB_LLWEAPONEX_Debug_LoopingAnim(_Character)
THEN
PlayAnimation(_Character, "attack1", "LLWEAPONEX_Debug_KeepPlayingAtttackAnim");

IF
TextEventSet("llweap_greatbowfxanimtest")
AND
CharacterGetHostCharacter(_Character)
THEN
DB_LLWEAPONEX_Debug_LoopingAnim(_Character);
PlayAnimation(_Character, "attack1", "LLWEAPONEX_Debug_KeepPlayingAtttackAnim");

IF
TextEventSet("llweap_greatbowfxanimtest")
AND
CharacterGetHostCharacter(_Character)
AND
NOT DB_LLWEAPONEX_Greatbows_Temp_ActivePrepareFX(_Character, _)
AND
IsTagged(_Character, "FEMALE", _Female)
AND
DB_LLWEAPONEX_Greatbows_PrepareFX(_RaceTag, _Female, _EffectName, _BoneName, _Duration)
AND
NOT DB_LLWEAPONEX_Greatbows_Temp_ActivePrepareFX(_Character, _)
AND
IsTagged(_Character, _RaceTag, 1)
AND
PlayLoopEffect(_Character, _EffectName, _BoneName, _FxHandle)
THEN
DB_LLWEAPONEX_Greatbows_Temp_ActivePrepareFX(_Character, _FxHandle);

IF
TextEventSet("llweap_greatbowfxteststop")
AND
CharacterGetHostCharacter(_Character)
THEN
NOT DB_LLWEAPONEX_Debug_LoopingAnim(_Character);

IF
TextEventSet("llweap_greatbowfxtest")
AND
CharacterGetHostCharacter(_Character)
AND
NOT DB_LLWEAPONEX_Greatbows_Temp_ActivePrepareFX(_Character, _)
AND
IsTagged(_Character, "FEMALE", _Female)
AND
DB_LLWEAPONEX_Greatbows_PrepareFX(_RaceTag, _Female, _EffectName, _BoneName, _Duration)
AND
NOT DB_LLWEAPONEX_Greatbows_Temp_ActivePrepareFX(_Character, _)
AND
IsTagged(_Character, _RaceTag, 1)
AND
PlayLoopEffect(_Character, _EffectName, _BoneName, _FxHandle)
THEN
DB_LLWEAPONEX_Greatbows_Temp_ActivePrepareFX(_Character, _FxHandle);

IF
TextEventSet("llweap_greatbowfxteststop")
AND
DB_LLWEAPONEX_Greatbows_Temp_ActivePrepareFX(_Character, _FxHandle)
THEN
StopLoopEffect(_FxHandle);
NOT DB_LLWEAPONEX_Greatbows_Temp_ActivePrepareFX(_Character, _FxHandle);
//END_REGION

//REGION CHAOS_SKILLS
/*
IF
CharacterUsedSkillAtPosition(_Character, _tx, _ty, _tz, "Cone_LLWEAPONEX_DebugConeSkill", _, _)
AND
GetPosition(_Character, _x, _y, _z)
THEN
*/

IF
CharacterUsedSkill(_Character, "Projectile_LLWEAPONEX_ChaosSlash", _, _)
THEN
DB_LLWEAPONEX_Skills_Temp_ChaosSlashCaster(_Character);

IF
CharacterUsedSkill(_Character, "Projectile_LLWEAPONEX_EnemyChaosSlash", _, _)
THEN
DB_LLWEAPONEX_Skills_Temp_ChaosSlashCaster(_Character);

IF
StoryEvent((ITEMGUID)_MovingObject, "LLWEAPONEX_Commands_StartDrawingChaosSurface")
AND
DB_LLWEAPONEX_Skills_Temp_ChaosSlashCaster(_Character)
AND
GetVarFloat(_MovingObject, "LLWEAPONEX_Radius", _Radius)
AND
GetVarFloat(_MovingObject, "LLWEAPONEX_Lifetime", _Lifetime)
AND
LeaderLib_Array_QRY_Random("LLWEAPONEX_ChaosSurfaces")
AND
DB_LeaderLib_Array_Temp_RandomResult("LLWEAPONEX_ChaosSurfaces", _Index, _Surface)
AND
DrawSurfaceOnPath(_Character, _MovingObject, _Surface, _Radius, _Lifetime, _SurfaceActionHandle)
THEN
NOT DB_LeaderLib_Array_Temp_RandomResult("LLWEAPONEX_ChaosSurfaces", _Index, _Surface);
NOT DB_LLWEAPONEX_Skills_Temp_ChaosSlashCaster(_Character);
DB_LLWEAPONEX_Skills_Temp_ChaosSlicePath(_Character, _MovingObject, _SurfaceActionHandle, _Surface);

IF
CharacterItemEvent(_Character, _MovingObject, "LLWEAPONEX_Commands_StopDrawingChaosSurface")
AND
DB_LLWEAPONEX_Skills_Temp_ChaosSlicePath(_Character, _MovingObject, _SurfaceActionHandle, _Surface)
AND
GetPosition(_MovingObject, _x, _y, _z)
THEN
NOT DB_LLWEAPONEX_Skills_Temp_ChaosSlicePath(_Character, _MovingObject, _SurfaceActionHandle,_Surface);
StopDrawSurfaceOnPath(_SurfaceActionHandle);
ItemDestroy(_MovingObject);
CreateSurfaceAtPosition(_x, _y, _z, _Surface, 1.0, 12.0);

IF
CharacterUsedSkill(_Character, "Rush_LLWEAPONEX_EnemyChaosCharge", _, _)
AND
LeaderLib_Array_QRY_Random("LLWEAPONEX_ChaosSurfaces")
AND
DB_LeaderLib_Array_Temp_RandomResult("LLWEAPONEX_ChaosSurfaces", _Index, _Surface)
AND
DrawSurfaceOnPath(_Character, _Character, _Surface, 0.5, 12.0, _SurfaceActionHandle)
THEN
NOT DB_LeaderLib_Array_Temp_RandomResult("LLWEAPONEX_ChaosSurfaces", _Index, _Surface);
DB_LLWEAPONEX_Skills_Temp_ChaosChargeDrawing(_Character, _Surface, _SurfaceActionHandle);

IF
SkillCast(_Character, "Rush_LLWEAPONEX_EnemyChaosCharge", _, _)
THEN
ProcObjectTimer(_Character, "LLWEAPONEX_Timers_StopChaosChargeDrawing", 800);

PROC
ProcObjectTimerFinished((CHARACTERGUID)_Character, "LLWEAPONEX_Timers_StopChaosChargeDrawing")
AND
DB_LLWEAPONEX_Skills_Temp_ChaosChargeDrawing(_Character, _Surface, _SurfaceActionHandle)
THEN
NOT DB_LLWEAPONEX_Skills_Temp_ChaosChargeDrawing(_Character, _Surface, _SurfaceActionHandle);
StopDrawSurfaceOnPath(_SurfaceActionHandle);
CreateSurface(_Character, _Surface, 1.0, 12.0);
//END_REGION


EXITSECTION

ENDEXITSECTION
ParentTargetEdge "LaughingLeader_WeaponExpansion"
