Version 1
SubGoalCombiner SGC_AND
INITSECTION
KBSECTION
//REGION SMUGGLERS_BAG
IF
CharacterItemEvent(_Char, _Item, "LLWEAPONEX_OpenSmugglersBag")
THEN
NRD_ModCall("WeaponExpansion", "OnSmugglersBagOpened", (STRING)_Char, (STRING)_Item);
//END_REGION

//REGION DELTAMODS
IF
NRD_ItemDeltaModIteratorEvent("LLWEAPONEX_Iterator_GetDeltamod", _Item, _Deltamod, _IsGenerated)
THEN
NRD_ModCall("WeaponExpansion", "SaveDeltamod", (STRING)_Item, _DeltaMod, (STRING)_IsGenerated);
//END_REGION

//REGION DELTAMOD_CHECK_EVENTS
IF
ItemTemplateOpening(_Template, _Item, _Character)
AND
GetUUID(_Item, _UUID)
AND
NRD_ModQuery1("WeaponExpansion", "CanParseContainerTreasure", _UUID)
THEN
ObjectSetFlag(_Item, "LLWEAPONEX_ParsedGeneratedItems", 0);
NRD_ModCall("WeaponExpansion", "OnItemTemplateOpening", (STRING)_Character, _UUID, _Template);

IF
CharacterLootedCharacterCorpse(_Player, _Corpse)
AND
GetUUID(_Corpse, _UUID)
AND
NRD_ModQuery1("WeaponExpansion", "CanParseCorpseTreasure", _UUID)
THEN
NRD_ModCall("WeaponExpansion", "CheckCharacterDeathTreasure", _UUID);

/*
IF
ItemAddedToContainer(_Item, _Container)
AND
NRD_ItemGetGenerationParams(_Item, _BaseStat, _ItemType, _Level, _Seed) // Should fail if the item was not generated
AND
ObjectGetFlag(_Item, "LLWEAPONEX_ProcessedDeltamods", 0)
AND
GetUUID(_Item, _ItemUUID)
THEN
NRD_ModCall("WeaponExpansion", "SwapDeltamods", _ItemUUID, _BaseStat, _ItemType, (STRING)_Level, (STRING)_Seed);

IF
ItemAddedToCharacter(_Item, _Container)
AND
NRD_ItemGetGenerationParams(_Item, _BaseStat, _ItemType, _Level, _Seed)
AND
ObjectGetFlag(_Item, "LLWEAPONEX_ProcessedDeltamods", 0)
AND
GetUUID(_Item, _ItemUUID)
THEN
NRD_ModCall("WeaponExpansion", "SwapDeltamods", _ItemUUID, _BaseStat, _ItemType, (STRING)_Level, (STRING)_Seed);
*/

/*
IF
CharacterDied(_Char)
AND
CharacterIsPlayer(_Char, 0)
AND
CharacterIsSummon(_Char, 0)
AND
NRD_CharacterGetInt(_Char, "Resurrected", 0)
AND
ObjectGetFlag(_Char, "LLWEAPONEX_ParsedGeneratedItems", 0)
AND
GetUUID(_Char, _UUID)
THEN
NRD_ModCall("WeaponExpansion", "CheckCharacterDeathTreasure", _UUID);
*/

IF
StoryEvent(_Item, "LLWEAPONEX_Iterator_StoreFoundItem")
AND
GetUUID(_Item, _UUID)
THEN
NRD_ModCall("WeaponExpansion", "SaveContainerItem", _UUID);
//END_REGION

EXITSECTION
ENDEXITSECTION
ParentTargetEdge "LLWEAPONEX_03_GameScripts"