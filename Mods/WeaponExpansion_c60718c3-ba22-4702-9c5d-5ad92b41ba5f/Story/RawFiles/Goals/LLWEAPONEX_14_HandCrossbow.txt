Version 1
SubGoalCombiner SGC_AND
INITSECTION

KBSECTION
IF
SkillCast(_Character, "Shout_LLWEAPONEX_HandCrossbow_Reload", _, _)
THEN
LLWEAPONEX_HandCrossbow_Reload(_Character);
ClearTag(_Character, "LLWEAPONEX_HandCrossbow_CanReload");

PROC
LLWEAPONEX_HandCrossbow_Reload((CHARACTERGUID)_Character)
AND
CharacterGetEquippedItem(_Character, "Ring", (ITEMGUID)_HandCrossbow)
AND
IsTagged(_HandCrossbow, "LLWEAPONEX_HandCrossbow", 1)
AND
ItemGetMaxCharges(_HandCrossbow, _Max)
THEN
ItemAddCharges(_HandCrossbow, _Max);

PROC
LLWEAPONEX_HandCrossbow_Reload((CHARACTERGUID)_Character)
AND
CharacterGetEquippedItem(_Character, "Ring2", (ITEMGUID)_HandCrossbow)
AND
IsTagged(_HandCrossbow, "LLWEAPONEX_HandCrossbow", 1)
AND
ItemGetMaxCharges(_HandCrossbow, _Max)
THEN
ItemAddCharges(_HandCrossbow, _Max);

IF
ItemTemplateEquipped("ARM_UNIQUE_LLWEAPONEX_HandCrossbow_A_Ring_ad15f666-285d-4634-a832-ea643fa0a9d2", _Character)
THEN
LeaderLib_Tags_PreserveTag(_Character, "LLWEAPONEX_HandCrossbow_Equipped");
LLWEAPONEX_HandCrossbow_OnEquipped(_Character, "ARM_UNIQUE_LLWEAPONEX_HandCrossbow_A_Ring_ad15f666-285d-4634-a832-ea643fa0a9d2");

IF
ItemTemplateUnEquipped("ARM_UNIQUE_LLWEAPONEX_HandCrossbow_A_Ring_ad15f666-285d-4634-a832-ea643fa0a9d2", _Character)
THEN
LeaderLib_Tags_ClearPreservedTag(_Character, "LLWEAPONEX_HandCrossbow_Equipped");
LLWEAPONEX_HandCrossbow_OnUnEquipped(_Character, "ARM_UNIQUE_LLWEAPONEX_HandCrossbow_A_Ring_ad15f666-285d-4634-a832-ea643fa0a9d2");

//REGION SKILL_TAGS_SET
PROC
LLWEAPONEX_HandCrossbow_OnEquipped((CHARACTERGUID)_Character, (STRING)_Template)
AND
GetItemForItemTemplateInInventory(_Character, _Template, _HandCrossbow)
AND
ItemGetRuneItemTemplate(_HandCrossbow, 0, _RuneTemplate)
AND
DB_LeaderLib_Helper_Runes_Templates("WeaponExpansion.HandCrossbowBolt", _RuneTemplate)
THEN
LeaderLib_Tags_PreserveTag(_Character, "LLWEAPONEX_HandCrossbow_HasAmmo");
LeaderLog_Log("DEBUG", "[LLWEAPONEX_14_HandCrossbow:OnEquipped] Crossbow has ammo. ");

IF
ObjectWasTagged((CHARACTERGUID)_Character, "LLWEAPONEX_HandCrossbow_HasAmmo")
THEN
LLWEAPONEX_HandCrossbow_TagForReload(_Character);

PROC
LLWEAPONEX_HandCrossbow_TagForReload((CHARACTERGUID)_Character)
AND
GetItemForItemTemplateInInventory(_Character, "ARM_UNIQUE_LLWEAPONEX_HandCrossbow_A_Ring_ad15f666-285d-4634-a832-ea643fa0a9d2", _HandCrossbow)
AND
ItemGetCharges(_HandCrossbow, _Charges)
AND
ItemGetMaxCharges(_HandCrossbow, _MaxCharges)
AND
_Charges < _MaxCharges
THEN
LeaderLib_Tags_PreserveTag(_Character, "LLWEAPONEX_HandCrossbow_CanReload");
LeaderLog_Log("DEBUG", "[LLWEAPONEX_14_HandCrossbow:OnEquipped] Crossbow can reload. ");
//END_REGION

//REGION SKILL_TAGS_CLEAR
PROC
LLWEAPONEX_HandCrossbow_OnUnEquipped((CHARACTERGUID)_Character, (STRING)_Template)
THEN
LeaderLib_Tags_ClearPreservedTag(_Character, "LLWEAPONEX_HandCrossbow_CanReload");
LeaderLib_Tags_ClearPreservedTag(_Character, "LLWEAPONEX_HandCrossbow_HasAmmo");
//END_REGION
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "LLWEAPONEX_00_PostCC"